<!DOCTYPE html>

<html lang="pt-BR">

<head>

ย ย <meta charset="UTF-8" />

ย ย <meta name="viewport" content="width=device-width, initial-scale=1" />

ย ย <title>Belo Vidro - Minhas Rotas</title>

ย ย <script src="https://cdn.tailwindcss.com"></script>

ย ย <style>

ย ย ย ย body {

ย ย ย ย ย ย background-color: #1a202c; /* Fundo escuro */

ย ย ย ย ย ย color: #e2e8f0; /* Texto claro */

ย ย ย ย }

ย ย ย ย .sidebar {

ย ย ย ย ย ย background-color: #2d3748; /* Cor da barra lateral */

ย ย ย ย }

ย ย ย ย .main-content {

ย ย ย ย ย ย background-color: #2d3748; /* Cor do container principal */

ย ย ย ย }

ย ย ย ย .hidden { display: none; }

ย ย ย ย .etapa-status-pendente { border-left: 4px solid #f9a825; }

ย ย ย ย .etapa-status-andamento { border-left: 4px solid #3b82f6; }

ย ย ย ย .etapa-status-concluido { border-left: 4px solid #10b981; }

ย ย ย ย .completion-modal {

ย ย ย ย ย ย position: fixed;

ย ย ย ย ย ย top: 0;

ย ย ย ย ย ย left: 0;

ย ย ย ย ย ย width: 100%;

ย ย ย ย ย ย height: 100%;

ย ย ย ย ย ย background-color: rgba(0, 0, 0, 0.5);

ย ย ย ย ย ย display: flex;

ย ย ย ย ย ย justify-content: center;

ย ย ย ย ย ย align-items: center;

ย ย ย ย ย ย z-index: 50;

ย ย ย ย }

ย ย ย ย .completion-modal-content {

ย ย ย ย ย ย background-color: #1e293b;

ย ย ย ย ย ย padding: 20px;

ย ย ย ย ย ย border-radius: 8px;

ย ย ย ย ย ย width: 90%;

ย ย ย ย ย ย max-width: 500px;

ย ย ย ย }

ย ย ย ย .filter-button.active {

ย ย ย ย ย ย background-color: #48bb78; /* Verde */

ย ย ย ย ย ย color: white;

ย ย ย ย }

ย ย ย ย .filter-button {

ย ย ย ย ย ย background-color: #4a5568; /* Cinza escuro */

ย ย ย ย ย ย color: #e2e8f0;

ย ย ย ย }

ย ย ย ยย

ย ย ย ย /* Novas classes para a barra lateral expansรญvel */

ย ย ย ย .sidebar {

ย ย ย ย ย ย width: 64px; /* Largura inicial, ajustรกvel */

ย ย ย ย ย ย transition: width 0.3s ease-in-out;

ย ย ย ย ย ย white-space: nowrap; /* Impede que o texto quebre a linha */

ย ย ย ย }

ย ย ย ย .sidebar.expanded {

ย ย ย ย ย ย width: 256px; /* Largura expandida */

ย ย ย ย }

ย ย ย ย .sidebar-content {

ย ย ย ย ย ย display: none; /* Conteรบdo escondido por padrรฃo */

ย ย ย ย }

ย ย ย ย .sidebar.expanded .sidebar-content {

ย ย ย ย ย ย display: flex; /* Conteรบdo visรญvel quando expandido */

ย ย ย ย }

ย ย </style>

</head>

<body class="flex min-h-screen">



ย ย <aside id="sidebar" class="sidebar flex flex-col items-center p-2 h-screen">

ย ย ย ย <button id="toggle-sidebar" class="text-white p-2 mb-4 self-end">

ย ย ย ย ย ย <span class="text-2xl">โก๏ธ</span>

ย ย ย ย </button>

ย ย ย ย <div id="sidebar-content" class="flex-1 flex flex-col items-center">

ย ย ย ย ย ย <h1 class="text-2xl font-bold mb-8 text-green-400">Belo Vidro</h1>

ย ย ย ย ย ย <div class="user-info text-center mb-8">

ย ย ย ย ย ย ย ย <h2 class="text-lg font-semibold" id="nome-usuario-sidebar"></h2>

ย ย ย ย ย ย ย ย <p class="text-sm text-gray-400">PAINEL DO FUNCIONรRIO</p>

ย ย ย ย ย ย </div>

ย ย ย ย ย ย <nav class="flex flex-col w-full space-y-4">

ย ย ย ย ย ย ย ย <a href="painel-do-funcionario.html" class="flex items-center px-4 py-2 rounded-lg text-gray-300 hover:bg-gray-700">

ย ย ย ย ย ย ย ย ย ย <span class="mr-3">๐</span> Inรญcio

ย ย ย ย ย ย ย ย </a>

ย ย ย ย ย ย ย ย <a href="painel de rotas.html" class="flex items-center px-4 py-2 rounded-lg text-gray-300 hover:bg-gray-700">

ย ย ย ย ย ย ย ย ย ย <span class="mr-3">๐บ๏ธ</span> Minhas Rotas

ย ย ย ย ย ย ย ย </a>

ย ย ย ย ย ย ย ย <button id="btnSair" class="flex items-center px-4 py-2 rounded-lg text-red-400 hover:bg-gray-700 mt-auto">

ย ย ย ย ย ย ย ย ย ย <span class="mr-3">๐ช</span> Sair

ย ย ย ย ย ย ย ย </button>

ย ย ย ย ย ย </nav>

ย ย ย ย </div>

ย ย </aside>



ย ย <main class="flex-1 p-8">

ย ย ย ย <h2 class="text-2xl font-bold text-green-400 mb-6">Minhas Rotas</h2>

ย ย ย ยย

ย ย ย ย <div class="mb-4 flex items-center justify-between">

ย ย ย ย ย ย <div id="filter-buttons" class="flex gap-2">

ย ย ย ย ย ย ย ย <button data-filter="hoje" class="filter-button px-4 py-2 rounded-lg mr-2 active">Hoje</button>

ย ย ย ย ย ย ย ย <button data-filter="sempre" class="filter-button px-4 py-2 rounded-lg mr-2">Sempre</button>

ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div class="flex items-center gap-3">

ย ย ย ย ย ย ย ย <span id="nome-usuario-header" class="text-sm text-slate-300"></span>

ย ย ย ย ย ย ย ย <div class="h-10 w-10 rounded-full bg-slate-700"></div>

ย ย ย ย ย ย </div>

ย ย ย ย </div>



ย ย ย ย <section class="main-content rounded-xl p-5 shadow">

ย ย ย ย ย ย <div id="loadingMessage" class="text-center py-4">

ย ย ย ย ย ย ย ย Carregando suas rotas...

ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div id="rotasContainer" class="mt-4 space-y-4">

ย ย ย ย ย ย </div>

ย ย ย ย </section>

ย ย </main>



ย ย <div id="modalTroca" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-50">

ย ย ย ย <div class="bg-slate-800 text-white rounded-lg p-6 w-96 shadow-lg">

ย ย ย ย ย ย <h3 class="text-lg font-bold mb-3">Solicitar Troca de Rota</h3>

ย ย ย ย ย ย <p class="text-slate-300 mb-4">Tem certeza que deseja solicitar a troca desta rota? Uma notificaรงรฃo serรก enviada ao chefe.</p>

ย ย ย ย ย ย <div class="flex justify-end gap-2">

ย ย ย ย ย ย ย ย <button onclick="fecharModalTroca()" class="px-4 py-2 bg-slate-700 text-white rounded-lg">Cancelar</button>

ย ย ย ย ย ย ย ย <button onclick="confirmarTrocaDeRota()" class="px-4 py-2 bg-red-600 text-white rounded-lg">Confirmar</button>

ย ย ย ย ย ย </div>

ย ย ย ย </div>

ย ย </div>



ย ย <div id="actionModal" class="completion-modal hidden">

ย ย ย ย <div class="completion-modal-content text-center">

ย ย ย ย ย ย <h3 class="text-lg font-bold mb-4">Escolha uma aรงรฃo</h3>

ย ย ย ย ย ย <p class="mb-6">O que vocรช gostaria de fazer para concluir a rota?</p>

ย ย ย ย ย ยย

ย ย ย ย ย ย <div id="botoesAcao" class="flex flex-col gap-4 mb-6">

ย ย ย ย ย ย ย ย <button id="btnImagem" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors duration-200">

ย ย ย ย ย ย ย ย ย ย ๐ธ Enviar Imagem

ย ย ย ย ย ย ย ย </button>

ย ย ย ย ย ย ย ย <button id="btnJustificar" class="px-6 py-3 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg transition-colors duration-200">

ย ย ย ย ย ย ย ย ย ย โ๏ธ Justificar

ย ย ย ย ย ย ย ย </button>

ย ย ย ย ย ย </div>



ย ย ย ย ย ย <div id="formImagem" class="hidden">

ย ย ย ย ย ย ย ย <h4 class="text-md font-semibold mb-2">Anexar Imagem</h4>

ย ย ย ย ย ย ย ย <input type="file" id="imagemInput" accept="image/*" class="w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100 mb-4" />

ย ย ย ย ย ย ย ย <button onclick="enviarImagem()" class="w-full px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors duration-200">

ย ย ย ย ย ย ย ย ย ย โ Enviar e Concluir

ย ย ย ย ย ย ย ย </button>

ย ย ย ย ย ย </div>



ย ย ย ย ย ย <div id="formJustificativa" class="hidden">

ย ย ย ย ย ย ย ย <h4 class="text-md font-semibold mb-2">Digite a Justificativa</h4>

ย ย ย ย ย ย ย ย <textarea id="justificativaInput" rows="4" class="w-full p-2 rounded-lg bg-slate-700 text-white mb-4"></textarea>

ย ย ย ย ย ย ย ย <button onclick="enviarJustificativa()" class="w-full px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors duration-200">

ย ย ย ย ย ย ย ย ย ย ๐ Enviar e Concluir

ย ย ย ย ย ย ย ย </button>

ย ย ย ย ย ย </div>



ย ย ย ย ย ย <button onclick="closeActionModal()" class="mt-4 text-sm text-slate-400 hover:text-white">Cancelar</button>

ย ย ย ย </div>

ย ย </div>



ย ย <script type="module">

ย ย ย ย import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";

ย ย ย ย import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js";



ย ย ย ย // O cรณdigo de proteรงรฃo deve ser o primeiro a rodar

ย ย ย ย (function protect(requiredRoles = ["funcionario", "funcionariorota" ]) {

ย ย ย ย ย ย try {

ย ย ย ย ย ย ย ย const s = JSON.parse(localStorage.getItem("bv.session") || "null");

ย ย ย ย ย ย ย ย if (!s || !requiredRoles.includes(s.role)) location.replace("https://belovidro.github.io/belo-vidro-app-interno");

ย ย ย ย ย ย } catch(e){ location.replace("https://belovidro.github.io/belo-vidro-app-interno"); }

ย ย ย ย })();



ย ย ย ย const sessao = JSON.parse(localStorage.getItem("bv.session") || "null");

ย ย ย ย const NOME_FUNC = sessao?.name || "Funcionรกrio";



ย ย ย ย document.getElementById("nome-usuario-sidebar").textContent = NOME_FUNC;

ย ย ย ย document.getElementById("nome-usuario-header").textContent = NOME_FUNC;



ย ย ย ย const firebaseConfig = {

ย ย ย ย ย ย apiKey: "AIzaSyDQGXH3b2bMR7ZdKPZm-vPONKijkRw-Xgg",

ย ย ย ย ย ย authDomain: "belo-vidro-banco-de-dados.firebaseapp.com",

ย ย ย ย ย ย projectId: "belo-vidro-banco-de-dados",

ย ย ย ย ย ย storageBucket: "belo-vidro-banco-de-dados.firebasestorage.app",

ย ย ย ย ย ย messagingSenderId: "705873952615",

ย ย ย ย ย ย appId: "1:705873952615:web:83613fd5d2839aad66b9c2",

ย ย ย ย ย ย databaseURL: "https://belo-vidro-banco-de-dados-default-rtdb.firebaseio.com"

ย ย ย ย };



ย ย ย ย const app = initializeApp(firebaseConfig);

ย ย ย ย const db = getDatabase(app);



ย ย ย ย let currentRotaId = null;

ย ย ย ย let currentEtapaIndex = null;

ย ย ย ย let currentEtapaData = null;

ย ย ย ย let dadosFirebase = null;

ย ย ย ย let rotaIdParaTroca = null;



ย ย ย ย function normalizaNome(s) {

ย ย ย ย ย ย return (s || "").toString().trim().toLowerCase();

ย ย ย ย }



ย ย ย ย window.fecharModalTroca = () => {

ย ย ย ย ย ย document.getElementById("modalTroca").classList.add("hidden");

ย ย ย ย ย ย document.getElementById("modalTroca").classList.remove("flex");

ย ย ย ย ย ย rotaIdParaTroca = null;

ย ย ย ย };

ย ย ย ยย

ย ย ย ย window.solicitarTroca = (rotaId) => {

ย ย ย ย ย ย rotaIdParaTroca = rotaId;

ย ย ย ย ย ย document.getElementById("modalTroca").classList.remove("hidden");

ย ย ย ย ย ย document.getElementById("modalTroca").classList.add("flex");

ย ย ย ย };



ย ย ย ย window.confirmarTrocaDeRota = () => {

ย ย ย ย ย ย if (rotaIdParaTroca) {

ย ย ย ย ย ย ย ย const rotaRef = ref(db, `rotas/${rotaIdParaTroca}`);

ย ย ย ย ย ย ย ย update(rotaRef, { status_troca: "solicitada" })

ย ย ย ย ย ย ย ย ย ย .then(() => {

ย ย ย ย ย ย ย ย ย ย ย ย alert("Sua solicitaรงรฃo de troca foi enviada ao chefe.");

ย ย ย ย ย ย ย ย ย ย ย ย fecharModalTroca();

ย ย ย ย ย ย ย ย ย ย })

ย ย ย ย ย ย ย ย ย ย .catch(err => {

ย ย ย ย ย ย ย ย ย ย ย ย console.error("Erro ao solicitar troca:", err);

ย ย ย ย ย ย ย ย ย ย ย ย alert("Erro ao enviar solicitaรงรฃo.");

ย ย ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย }

ย ย ย ย };



ย ย ย ย window.openActionModal = (rotaId, etapaIndex, etapaData) => {

ย ย ย ย ย ย currentRotaId = rotaId;

ย ย ย ย ย ย currentEtapaIndex = etapaIndex;

ย ย ย ย ย ย currentEtapaData = etapaData;

ย ย ย ย ย ย document.getElementById("actionModal").classList.remove("hidden");

ย ย ย ย ย ย document.getElementById("actionModal").classList.add("flex");

ย ย ย ย };



ย ย ย ย window.closeActionModal = () => {

ย ย ย ย ย ย document.getElementById("actionModal").classList.add("hidden");

ย ย ย ย ย ย document.getElementById("actionModal").classList.remove("flex");

ย ย ย ย ย ย document.getElementById("botoesAcao").classList.remove("hidden");

ย ย ย ย ย ย document.getElementById("btnImagem").classList.remove("hidden");

ย ย ย ย ย ย document.getElementById("btnJustificar").classList.remove("hidden");

ย ย ย ย ย ย document.getElementById("formImagem").classList.add("hidden");

ย ย ย ย ย ย document.getElementById("formJustificativa").classList.add("hidden");

ย ย ย ย ย ย document.getElementById("imagemInput").value = null;

ย ย ย ย ย ย document.getElementById("justificativaInput").value = '';

ย ย ย ย };



ย ย ย ย document.getElementById('btnImagem').addEventListener('click', () => {

ย ย ย ย ย ย document.getElementById('botoesAcao').classList.add('hidden');

ย ย ย ย ย ย document.getElementById('formImagem').classList.remove('hidden');

ย ย ย ย });



ย ย ย ย document.getElementById('btnJustificar').addEventListener('click', () => {

ย ย ย ย ย ย document.getElementById('botoesAcao').classList.add('hidden');

ย ย ย ย ย ย document.getElementById('formJustificativa').classList.remove('hidden');

ย ย ย ย });



ย ย ย ย window.enviarImagem = async () => {

ย ย ย ย ย ย const imagemInput = document.getElementById("imagemInput");

ย ย ย ย ย ย const file = imagemInput.files[0];



ย ย ย ย ย ย if (!file) {

ย ย ย ย ย ย ย ย alert("Por favor, selecione uma imagem para enviar.");

ย ย ย ย ย ย ย ย return;

ย ย ย ย ย ย }



ย ย ย ย ย ย const btn = document.getElementById("formImagem").querySelector('button');

ย ย ย ย ย ย btn.disabled = true;

ย ย ย ย ย ย btn.textContent = 'Enviando...';



ย ย ย ย ย ย const formData = new FormData();

ย ย ย ย ย ย formData.append('imagem', file);

ย ย ย ย ย ย formData.append('rotaId', currentRotaId);

ย ย ย ย ย ย formData.append('etapaIndex', currentEtapaIndex);

ย ย ย ย ย ย formData.append('nomeFuncionario', NOME_FUNC);

ย ย ย ย ย ย formData.append('local', currentEtapaData.local);

ย ย ย ย ย ยย

ย ย ย ย ย  const serverUrl = 'http://192.168.18.218/api/upload-imagem';


ย ย ย ย ย ย try {

ย ย ย ย ย ย ย ย const response = await fetch(serverUrl, {

ย ย ย ย ย ย ย ย ย ย method: 'POST',

ย ย ย ย ย ย ย ย ย ย body: formData,

ย ย ย ย ย ย ย ย });



ย ย ย ย ย ย ย ย const result = await response.json();

ย ย ย ย ย ย ย ย if (response.ok && result.success) {

ย ย ย ย ย ย ย ย ย ย const etapaRef = ref(db, `rotas/${currentRotaId}/etapas/${currentEtapaIndex}`);

ย ย ย ย ย ย ย ย ย ย await update(etapaRef, { status: "concluido", imagem: result.fileName });ยย



ย ย ย ย ย ย ย ย ย ย alert("Imagem enviada e tarefa concluรญda!");

ย ย ย ย ย ย ย ย ย ย closeActionModal();

ย ย ย ย ย ย ย ย } else {

ย ย ย ย ย ย ย ย ย ย alert(`Erro ao enviar imagem: ${result.message}`);

ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย } catch (error) {

ย ย ย ย ย ย ย ย console.error("Erro na comunicaรงรฃo com o servidor:", error);

ย ย ย ย ย ย ย ย alert("Ocorreu um erro. Verifique sua conexรฃo e tente novamente.");

ย ย ย ย ย ย } finally {

ย ย ย ย ย ย ย ย btn.disabled = false;

ย ย ย ย ย ย ย ย btn.textContent = 'โ Enviar e Concluir';

ย ย ย ย ย ย }

ย ย ย ย };



ย ย ย ย window.enviarJustificativa = async () => {

ย ย ย ย ย ย const justificativa = document.getElementById("justificativaInput").value;



ย ย ย ย ย ย if (justificativa.trim() === '') {

ย ย ย ย ย ย ย ย alert("Por favor, digite uma justificativa.");

ย ย ย ย ย ย ย ย return;

ย ย ย ย ย ย }

ย ย ย ย ย ยย

ย ย ย ย ย ย const btn = document.getElementById("formJustificativa").querySelector('button');

ย ย ย ย ย ย btn.disabled = true;

ย ย ย ย ย ย btn.textContent = 'Enviando...';

ย ย ย ย ย ยย

ย ย ย ย ย ย const etapaRef = ref(db, `rotas/${currentRotaId}/etapas/${currentEtapaIndex}`);

ย ย ย ย ย ย try {

ย ย ย ย ย ย ย ย await update(etapaRef, { status: "concluido", justificativa: justificativa });

ย ย ย ย ย ย ย ย alert("Justificativa enviada e tarefa concluรญda!");

ย ย ย ย ย ย ย ย closeActionModal();

ย ย ย ย ย ย } catch (error) {

ย ย ย ย ย ย ย ย console.error("Erro ao salvar justificativa:", error);

ย ย ย ย ย ย ย ย alert("Erro ao enviar justificativa. Tente novamente.");

ย ย ย ย ย ย } finally {

ย ย ย ย ย ย ย ย btn.disabled = false;

ย ย ย ย ย ย ย ย btn.textContent = '๐ Enviar e Concluir';

ย ย ย ย ย ย }

ย ย ย ย };

ย ย ย ยย

ย ย ย ย window.iniciarTarefa = (rotaId, etapaIndex) => {

ย ย ย ย ย ย const etapaRef = ref(db, `rotas/${rotaId}/etapas/${etapaIndex}`);

ย ย ย ย ย ย update(etapaRef, { status: "andamento" })

ย ย ย ย ย ย ย ย .then(() => {

ย ย ย ย ย ย ย ย ย ย console.log(`Etapa ${etapaIndex} da rota ${rotaId} alterada para 'andamento'`);

ย ย ย ย ย ย ย ย })

ย ย ย ย ย ย ย ย .catch(error => {

ย ย ย ย ย ย ย ย ย ย console.error("Erro ao iniciar a etapa:", error);

ย ย ย ย ย ย ย ย ย ย alert("Erro ao iniciar a etapa. Tente novamente.");

ย ย ย ย ย ย ย ย });

ย ย ย ย };



ย ย ย ย function isToday(dateStr) {

ย ย ย ย ย ย const today = new Date();

ย ย ย ย ย ย const year = today.getFullYear();

ย ย ย ย ย ย const month = String(today.getMonth() + 1).padStart(2, '0');

ย ย ย ย ย ย const day = String(today.getDate()).padStart(2, '0');

ย ย ย ย ย ย return dateStr === `${year}-${month}-${day}`;

ย ย ย ย }

ย ย ย ยย

ย ย ย ย function renderizarRotasFiltradas(filtro) {

ย ย ย ย ย ย const container = document.getElementById("rotasContainer");

ย ย ย ย ย ย container.innerHTML = "";

ย ย ย ย ย ยย

ย ย ย ย ย ย const loadingMessage = document.getElementById("loadingMessage");

ย ย ย ย ย ย loadingMessage.style.display = 'block';



ย ย ย ย ย ย if (!dadosFirebase) {

ย ย ย ย ย ย ย ย loadingMessage.textContent = 'Carregando dados...';

ย ย ย ย ย ย ย ย return;

ย ย ย ย ย ย }

ย ย ย ย ย ยย

ย ย ย ย ย ย let rotasEncontradas = false;

ย ย ย ย ย ย let filtroFn;



ย ย ย ย ย ย document.querySelectorAll('.filter-button').forEach(btn => btn.classList.remove('active'));

ย ย ย ย ย ย document.querySelector(`[data-filter="${filtro}"]`).classList.add('active');



ย ย ย ย ย ย switch(filtro) {

ย ย ย ย ย ย ย ย case 'hoje':

ย ย ย ย ย ย ย ย ย ย filtroFn = (rota) => isToday(rota.data);

ย ย ย ย ย ย ย ย ย ย loadingMessage.textContent = 'Nenhuma rota encontrada para hoje.';

ย ย ย ย ย ย ย ย ย ย break;

ย ย ย ย ย ย ย ย case 'sempre':

ย ย ย ย ย ย ย ย ย ย filtroFn = (rota) => true;

ย ย ย ย ย ย ย ย ย ย loadingMessage.textContent = 'Nenhuma rota encontrada.';

ย ย ย ย ย ย ย ย ย ย break;

ย ย ย ย ย ย ย ย default:

ย ย ย ย ย ย ย ย ย ย filtroFn = (rota) => true;

ย ย ย ย ย ย ย ย ย ย break;

ย ย ย ย ย ย }

ย ย ย ย ย ยย

ย ย ย ย ย ย const rotasFiltradas = Object.entries(dadosFirebase).filter(([id, rota]) => {

ย ย ย ย ย ย ย ย const isMyRoute = normalizaNome(rota.funcionario) === normalizaNome(NOME_FUNC);

ย ย ย ย ย ย ย ย const isFilteredByDate = filtroFn(rota);

ย ย ย ย ย ย ย ย return isMyRoute && isFilteredByDate;

ย ย ย ย ย ย });

ย ย ย ย ย ยย

ย ย ย ย ย ย rotasFiltradas.sort((a, b) => {

ย ย ย ย ย ย ย ย const dateA = new Date(a[1].data);

ย ย ย ย ย ย ย ย const dateB = new Date(b[1].data);

ย ย ย ย ย ย ย ย return dateB - dateA;

ย ย ย ย ย ย });

ย ย ย ย ย ยย

ย ย ย ย ย ย if (rotasFiltradas.length > 0) {

ย ย ย ย ย ย ย ย rotasEncontradas = true;

ย ย ย ย ย ย ย ย loadingMessage.style.display = 'none';

ย ย ย ย ย ย ย ยย

ย ย ย ย ย ย ย ย rotasFiltradas.forEach(([rotaId, rota]) => {

ย ย ย ย ย ย ย ย ย ย const rotaCard = document.createElement("div");

ย ย ย ย ย ย ย ย ย ย rotaCard.className = "bg-slate-700 rounded-lg p-4 shadow-md";

ย ย ย ย ย ย ย ย ย ย rotaCard.innerHTML = `

ย ย ย ย ย ย ย ย ย ย ย ย <div class="flex items-center justify-between cursor-pointer header-rota">

ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="flex items-center space-x-2">

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="expand-icon text-sm text-white">โถ๏ธ</span>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="font-bold">${rota.data} - Rota ${rotaId.slice(0, 8)}</span>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="flex items-center space-x-2">

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="text-xs text-slate-400">Status: ${rota.status_troca || 'OK'}</span>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="solicitarTroca('${rotaId}')" class="bg-red-500 hover:bg-red-600 text-white text-xs px-3 py-1 rounded">

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Solicitar Troca

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย <div class="etapas-content hidden mt-4 space-y-2">

ย ย ย ย ย ย ย ย ย ย ย ย ย ย <ul id="etapas-ul-${rotaId}"></ul>

ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย `;

ย ย ย ย ย ย ย ย ย ย container.appendChild(rotaCard);



ย ย ย ย ย ย ย ย ย ย rotaCard.querySelector('.header-rota').addEventListener('click', (e) => {

ย ย ย ย ย ย ย ย ย ย ย ย if (e.target.tagName === 'BUTTON' || e.target.parentElement.tagName === 'BUTTON') {

ย ย ย ย ย ย ย ย ย ย ย ย ย ย return;

ย ย ย ย ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย ย ย ย ย const content = rotaCard.querySelector('.etapas-content');

ย ย ย ย ย ย ย ย ย ย ย ย const icon = rotaCard.querySelector('.expand-icon');

ย ย ย ย ย ย ย ย ย ย ย ย content.classList.toggle('hidden');

ย ย ย ย ย ย ย ย ย ย ย ย icon.textContent = content.classList.contains('hidden') ? 'โถ๏ธ' : '๐ฝ';

ย ย ย ย ย ย ย ย ย ย });



ย ย ย ย ย ย ย ย ย ย const etapasUl = document.getElementById(`etapas-ul-${rotaId}`);

ย ย ย ย ย ย ย ย ย ย if (rota.etapas) {

ย ย ย ย ย ย ย ย ย ย ย ย const etapasArray = Object.values(rota.etapas);



ย ย ย ย ย ย ย ย ย ย ย ย etapasArray.forEach((etapa, idx) => {

ย ย ย ย ย ย ย ย ย ย ย ย ย ย let actionButton = '';

ย ย ย ย ย ย ย ย ย ย ย ย ย ย switch (etapa.status) {

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย case 'andamento':

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย actionButton = `<button onclick="openActionModal('${rotaId}', ${idx}, ${JSON.stringify(etapa).replace(/"/g, "'")})" class="bg-green-500 hover:bg-green-600 text-white text-xs px-3 py-1 rounded">Concluir</button>`;

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย break;

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย case 'concluido':

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย actionButton = '<span class="text-xs text-green-400">Concluรญdo</span>';

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย break;

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย default:

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย actionButton = `<button onclick="iniciarTarefa('${rotaId}', ${idx})" class="bg-indigo-500 hover:bg-indigo-600 text-white text-xs px-3 py-1 rounded">Iniciar</button>`;

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย break;

ย ย ย ย ย ย ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย ย ย ย ย ย ย const li = document.createElement('li');

ย ย ย ย ย ย ย ย ย ย ย ย ย ย li.className = `etapa-item bg-slate-600 rounded-lg p-3 flex justify-between items-center etapa-status-${etapa.status}`;

ย ย ย ย ย ย ย ย ย ย ย ย ย ย li.innerHTML = `

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="font-medium">${etapa.local}</p>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="text-xs text-slate-300">${etapa.descricao}</p>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="ml-4">${actionButton}</div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย `;

ย ย ย ย ย ย ย ย ย ย ย ย ย ย etapasUl.appendChild(li);

ย ย ย ย ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย }

ย ย ย ย ย ยย

ย ย ย ย ย ย if (!rotasEncontradas) {

ย ย ย ย ย ย ย ย loadingMessage.style.display = 'block';

ย ย ย ย ย ย } else {

ย ย ย ย ย ย ย ย loadingMessage.style.display = 'none';

ย ย ย ย ย ย }

ย ย ย ย }



ย ย ย ย const rotasRef = ref(db, "rotas");

ย ย ย ย onValue(rotasRef, (snapshot) => {

ย ย ย ย ย ย dadosFirebase = snapshot.val();

ย ย ย ย ย ย renderizarRotasFiltradas('hoje');

ย ย ย ย }, (err) => {

ย ย ย ย ย ย console.error("Erro ao ler rotas:", err);

ย ย ย ย ย ย document.getElementById("loadingMessage").textContent = 'Erro ao carregar rotas.';

ย ย ย ย });

ย ย ย ยย

ย ย ย ย document.getElementById('filter-buttons').addEventListener('click', (event) => {

ย ย ย ย ย ย const button = event.target.closest('.filter-button');

ย ย ย ย ย ย if (button) {

ย ย ย ย ย ย ย ย const filtro = button.getAttribute('data-filter');

ย ย ย ย ย ย ย ย renderizarRotasFiltradas(filtro);

ย ย ย ย ย ย }

ย ย ย ย });



ย ย ย ย document.getElementById('btnSair').addEventListener('click', () => {

ย ย ย ย ย ย localStorage.removeItem("bv.session");

ย ย ย ย ย ย window.location.href = "https://belovidro.github.io/belo-vidro-app-interno";

ย ย ย ย });

ย ย ย ยย

ย ย ย ย // Lรณgica para a barra lateral expansรญvel

ย ย ย ย document.addEventListener('DOMContentLoaded', () => {

ย ย ย ย ย ย const sidebar = document.getElementById('sidebar');

ย ย ย ย ย ย const toggleBtn = document.getElementById('toggle-sidebar');

ย ย ย ย ย ย const sidebarContent = document.getElementById('sidebar-content');

ย ย ย ยย

ย ย ย ย ย ย function toggleSidebar() {

ย ย ย ย ย ย ย ย const isExpanded = sidebar.classList.toggle('expanded');

ย ย ย ย ย ย ย ย if (isExpanded) {

ย ย ย ย ย ย ย ย ย ย toggleBtn.innerHTML = 'โฌ๏ธ';

ย ย ย ย ย ย ย ย ย ย sidebarContent.classList.remove('hidden');

ย ย ย ย ย ย ย ย ย ย sidebarContent.classList.add('flex');

ย ย ย ย ย ย ย ย } else {

ย ย ย ย ย ย ย ย ย ย toggleBtn.innerHTML = 'โก๏ธ';

ย ย ย ย ย ย ย ย ย ย sidebarContent.classList.remove('flex');

ย ย ย ย ย ย ย ย ย ย sidebarContent.classList.add('hidden');

ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย }

ย ย ย ยย

ย ย ย ย ย ย toggleBtn.addEventListener('click', toggleSidebar);

ย ย ย ยย

ย ย ย ย ย ย const mediaQuery = window.matchMedia('(min-width: 768px)');

ย ย ย ย ย ย function handleTabletChange(e) {

ย ย ย ย ย ย ย ย if (e.matches) {

ย ย ย ย ย ย ย ย ย ย sidebar.classList.add('expanded');

ย ย ย ย ย ย ย ย ย ย sidebarContent.classList.remove('hidden');

ย ย ย ย ย ย ย ย ย ย sidebarContent.classList.add('flex');

ย ย ย ย ย ย ย ย ย ย toggleBtn.innerHTML = 'โฌ๏ธ';

ย ย ย ย ย ย ย ย } else {

ย ย ย ย ย ย ย ย ย ย sidebar.classList.remove('expanded');

ย ย ย ย ย ย ย ย ย ย sidebarContent.classList.remove('flex');

ย ย ย ย ย ย ย ย ย ย sidebarContent.classList.add('hidden');

ย ย ย ย ย ย ย ย ย ย toggleBtn.innerHTML = 'โก๏ธ';

ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย }

ย ย ย ย ย ยย

ย ย ย ย ย ย mediaQuery.addListener(handleTabletChange);

ย ย ย ย ย ย handleTabletChange(mediaQuery);

ย ย ย ย });

ย ย </script>

</body>

</html>
